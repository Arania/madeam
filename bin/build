#!/bin/sh

BUILD_NAME=release

BIN_DIR=`pwd`

rm -rf /tmp/${BUILD_NAME}

echo "- Creating build directory"
mkdir /tmp/${BUILD_NAME}

echo "- CD to /tmp directory"
cd /tmp

echo "- Copying www directory into build directory"
cp -rv ${BIN_DIR}/../www/ ${BUILD_NAME}

echo "- Creating git clone in app/vendor/Madeam"
git clone -v ${BIN_DIR}/../../Madeam/ ${BUILD_NAME}/app/vendor/Madeam/

echo "- Removing .git from clone"
rm -rf ${BUILD_NAME}/app/vendor/Madeam/.git

echo "- Creating build zip and tgz archives"
tar -zcpPf ${BUILD_NAME}.tgz ${BUILD_NAME}
zip -rq ${BUILD_NAME}.zip ${BUILD_NAME}

exit

echo "- Copying build archives to remote over ssh"
scp -P 30000 ${BUILD_NAME}.tgz joshdavey@67.23.30.170:/home/joshdavey/public_html/madeam.com/public/builds/
scp -P 30000 ${BUILD_NAME}.zip joshdavey@67.23.30.170:/home/joshdavey/public_html/madeam.com/public/builds/

echo "- Removing build archives"
rm ${BUILD_NAME}.tgz
rm ${BUILD_NAME}.zip

echo "- Removing build directory"
rm -rf ${BUILD_NAME}