#!/bin/sh

BUILD_NAME=release

rm -rf /tmp/${BUILD_NAME}

echo "- Creating build directory"
mkdir /tmp/${BUILD_NAME}

echo "- Copying www directory into build directory"
cp -rv ../www/ /tmp/${BUILD_NAME}

echo "- Creating git clone in app/vendor/Madeam"
git clone -v ../../Madeam/ /tmp/${BUILD_NAME}/app/vendor/Madeam/

echo "- Creating build zip and tgz archives"
tar -zcpPf /tmp/${BUILD_NAME}.tgz /tmp/${BUILD_NAME}
#tar zcpf -C /tmp/${BUILD_NAME} > /tmp/${BUILD_NAME}.tgz
zip -rq /tmp/${BUILD_NAME}.zip /tmp/${BUILD_NAME}

echo "- Copying build archives to remote over ssh"
scp -P 30000 /tmp/${BUILD_NAME}.tgz joshdavey@67.23.30.170:/home/joshdavey/builds/
scp -P 30000 /tmp/${BUILD_NAME}.zip joshdavey@67.23.30.170:/home/joshdavey/builds/

echo "- Removing build archives"
rm /tmp/${BUILD_NAME}.tgz
rm /tmp/${BUILD_NAME}.zip

echo "- Removing build directory"
rm -rf /tmp/${BUILD_NAME}